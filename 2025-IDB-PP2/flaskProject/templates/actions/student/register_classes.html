{% extends 'layout.html' %}
{% block title %}Register Classes{% endblock %}

{% block content %}

<h3>Register for a Class</h3>
<p>{{ msg }}</p>

<label>Choose Course:</label>
<select id="course_select" class="form-control">
    <option value="">-- Select Course --</option>
    {% for c in courses %}
        <option value="{{ c[0] }}">{{ c[0] }} — {{ c[1] }}</option>
    {% endfor %}
</select>

<br>

<label>Choose Section:</label>
<select id="section_select" class="form-control">
    <option value="">-- Select Section --</option>
</select>

<br>

<form method="POST">
    <input type="hidden" name="enrollment_id" id="enrollment_id">
    <button type="submit" class="btn btn-primary">Register</button>
</form>

<script>
const courseSelect = document.getElementById("course_select");
const sectionSelect = document.getElementById("section_select");
const hiddenInput = document.getElementById("enrollment_id");

courseSelect.onchange = () => {
    const courseId = courseSelect.value;

    sectionSelect.innerHTML = `<option value="">-- Select Section --</option>`;

    if (!courseId) return;

    fetch(`/get_sections/${courseId}`)
        .then(res => res.json())
        .then(data => {
            data.forEach(sec => {
                const section_id = sec[0];
                const sec_code   = sec[1];
                const semester   = sec[2];
                const year       = sec[3];

                sectionSelect.innerHTML += `
                    <option value="${section_id}">
                        ${sec_code} — ${semester} ${year}
                    </option>
                `;
            });
        });
};

sectionSelect.onchange = () => {
    hiddenInput.value = sectionSelect.value;
};
</script>

{% endblock %}

{% extends "layout.html" %}

{% block title %}Class Rankings by Semester{% endblock %}

{% block content %}
<h2>Best and Worst Performing Classes for a Semester</h2>

{% if msg %}
    <div class="msg">{{ msg }}</div>
{% endif %}

<form method="POST" class="mb-4">
    <div class="row">
        <div class="col-md-4 mb-3">
            <label class="form-label">Semester</label>
            <select name="semester" class="form-select" required>
                <option value="">-- Select Semester --</option>
                <option value="Spring" {% if semester == 'Spring' %}selected{% endif %}>Spring</option>
                <option value="Summer" {% if semester == 'Summer' %}selected{% endif %}>Summer</option>
                <option value="Fall"   {% if semester == 'Fall' %}selected{% endif %}>Fall</option>
                <option value="Winter" {% if semester == 'Winter' %}selected{% endif %}>Winter</option>
            </select>
        </div>

        <div class="col-md-4 mb-3">
            <label class="form-label">Year</label>
            <input type="number" name="year" class="form-control"
                   min="2000" max="2099" required value="{{ year or '' }}">
        </div>
    </div>

    <button class="btn btn-primary">Show Rankings</button>
</form>

{% if results %}
    <h4>Rankings for {{ semester }} {{ year }}</h4>
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>Rank</th>
                <th>Course ID</th>
                <th>Title</th>
                <th>Average GPA</th>
            </tr>
        </thead>
        <tbody>
            {% for row in results %}
                {% set gpa = row[2] %}
                <tr class="
                    {% if loop.first and gpa is not none %}table-success
                    {% elif loop.last and gpa is not none %}table-danger
                    {% endif %}
                ">
                    <td>{{ loop.index }}</td>
                    <td>{{ row[0] }}</td>
                    <td>{{ row[1] }}</td>
                    <td>
                        {% if gpa is not none %}
                            {{ "%.2f"|format(gpa) }}
                        {% else %}
                            No graded enrollments
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No data available.</p>
{% endif %}

{% endblock %}